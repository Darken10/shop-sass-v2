import{c as E,e as B,j as e,L as G,H}from"./app-DqdLS_po.js";import{S as I,b as $,o as q,d as J,i as K}from"./SaleController-CWOAsHby.js";import{B as Q}from"./badge-DSvvMiB9.js";import{B as w}from"./button-DVQP8ugw.js";import{b as z,C as M,a as R,e as k,c as D,d as O}from"./card-z2brvHDy.js";import{I as P}from"./input-CikxobFJ.js";import{L as A}from"./label-CKEEuidP.js";import{c as U,a as W,b as X,S as Y,d as Z}from"./select-HYGYj5Xd.js";import{S as T}from"./separator-DGAiZpJH.js";import{A as ee,az as se}from"./app-layout-BY_z2l7K.js";import{S as V}from"./store-B14O_uPo.js";/* empty css            */import"./index-CJ7mWlm-.js";import"./index-CSEUMRIG.js";import"./index-CHdNXJ1h.js";import"./index-oTu_XNBi.js";import"./Combination-CjQPbJWN.js";import"./index-CQuKHLBU.js";import"./check-CFlOe0yf.js";import"./index-CxeexwSe.js";import"./index-BY9hahA7.js";import"./x-C_vLIVyO.js";import"./index-B_e8Ugpt.js";import"./app-logo-icon-BquCEMUK.js";import"./building-2-q9KNC_Mq.js";import"./warehouse-CXlB-vPY.js";import"./square-user-BhCGZFIc.js";import"./truck-D0hplmIV.js";const te=[{title:"Dashboard",href:"/dashboard"},{title:"Point de vente",href:K().url}];function qe(t){const s=E.c(36),{currentSession:n,shops:S}=t;let f;s[0]===Symbol.for("react.memo_cache_sentinel")?(f={opening_amount:0,shop_id:""},s[0]=f):f=s[0];const r=B(f);let h;s[1]===Symbol.for("react.memo_cache_sentinel")?(h={closing_notes:""},s[1]=h):h=s[1];const o=B(h);let C;e:{if(!n?.sales){let l;s[2]===Symbol.for("react.memo_cache_sentinel")?(l={total:0,cash:0,mobileMoney:0,bankCard:0,bankTransfer:0,credit:0,changeGiven:0},s[2]=l):l=s[2],C=l;break e}let a,i,m,d,u,x;if(s[3]!==n.sales){const l=n.sales.flatMap(he);a=n.sales.reduce(fe,0),i=l.filter(pe).reduce(xe,0),m=l.filter(ue).reduce(de,0),d=l.filter(me).reduce(ce,0),u=l.filter(oe).reduce(le,0),x=l.filter(ie).reduce(ae,0),s[3]=n.sales,s[4]=a,s[5]=i,s[6]=m,s[7]=d,s[8]=u,s[9]=x}else a=s[4],i=s[5],m=s[6],d=s[7],u=s[8],x=s[9];let p;s[10]!==n.sales?(p=n.sales.reduce(re,0),s[10]=n.sales,s[11]=p):p=s[11];let y;s[12]!==p||s[13]!==a||s[14]!==i||s[15]!==m||s[16]!==d||s[17]!==u||s[18]!==x?(y={total:a,cash:i,mobileMoney:m,bankCard:d,bankTransfer:u,credit:x,changeGiven:p},s[12]=p,s[13]=a,s[14]=i,s[15]=m,s[16]=d,s[17]=u,s[18]=x,s[19]=y):y=s[19],C=y}const c=C;let j;s[20]!==r?(j=function(i){i.preventDefault(),r.post(q().url)},s[20]=r,s[21]=j):j=s[21];const F=j;let g;s[22]!==o||s[23]!==n?(g=function(i){i.preventDefault(),n&&o.post(J(n.id).url)},s[22]=o,s[23]=n,s[24]=g):g=s[24];const L=g;let N;s[25]===Symbol.for("react.memo_cache_sentinel")?(N=e.jsx(H,{title:"Point de vente"}),s[25]=N):N=s[25];let b,_;s[26]===Symbol.for("react.memo_cache_sentinel")?(b=e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(I,{className:"size-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Point de vente"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gestion de la caisse"})]})]}),_=e.jsx(T,{}),s[26]=b,s[27]=_):(b=s[26],_=s[27]);let v;return s[28]!==o||s[29]!==n||s[30]!==L||s[31]!==F||s[32]!==c||s[33]!==r||s[34]!==S?(v=e.jsxs(ee,{breadcrumbs:te,children:[N,e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[b,_,n?e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(z,{children:[e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"size-5"}),"Session active"]}),e.jsx(Q,{variant:"default",children:"Ouverte"})]}),e.jsxs(k,{children:["Session #",n.session_number]})]}),e.jsxs(D,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Magasin"}),e.jsx("span",{className:"font-medium",children:n.shop.name})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Caissier"}),e.jsx("span",{className:"font-medium",children:n.cashier.name})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ouverture"}),e.jsx("span",{className:"font-medium",children:new Date(n.opened_at).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Montant initial"}),e.jsxs("span",{className:"font-bold text-primary",children:[Number(n.opening_amount).toLocaleString("fr-FR")," FCFA"]})]}),e.jsx(T,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ventes réalisées"}),e.jsx("span",{className:"font-medium",children:n.sales?.length??0})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total ventes"}),e.jsxs("span",{className:"font-bold text-green-600",children:[c.total.toLocaleString("fr-FR")," FCFA"]})]}),e.jsx(T,{}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Total en caisse"}),e.jsxs("span",{className:"text-primary",children:[(Number(n.opening_amount)+c.total).toLocaleString("fr-FR")," FCFA"]})]})]}),e.jsx(O,{className:"flex gap-2",children:e.jsx(w,{asChild:!0,className:"flex-1",children:e.jsxs(G,{href:$().url,children:[e.jsx(I,{className:"size-4"}),"Vendre"]})})})]}),e.jsxs(z,{children:[e.jsxs(M,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"size-5"}),"Fermer la caisse"]}),e.jsx(k,{children:"Fermez votre session en fin de journée."})]}),e.jsxs("form",{onSubmit:L,children:[e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg bg-muted p-3 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Espèces"}),e.jsx("p",{className:"font-bold",children:c.cash.toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"rounded-lg bg-muted p-3 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mobile Money"}),e.jsx("p",{className:"font-bold",children:c.mobileMoney.toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"rounded-lg bg-muted p-3 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carte bancaire"}),e.jsx("p",{className:"font-bold",children:c.bankCard.toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"rounded-lg bg-muted p-3 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Créances"}),e.jsx("p",{className:"font-bold",children:c.credit.toLocaleString("fr-FR")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"closing_notes",children:"Notes de fermeture"}),e.jsx(P,{id:"closing_notes",type:"text",placeholder:"Notes optionnelles...",value:o.data.closing_notes,onChange:a=>o.setData("closing_notes",a.target.value)})]})]}),e.jsx(O,{children:e.jsx(w,{type:"submit",variant:"destructive",className:"w-full",disabled:o.processing,children:o.processing?"Fermeture…":"Fermer la caisse"})})]})]})]}):e.jsxs(z,{className:"mx-auto w-full max-w-lg",children:[e.jsxs(M,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-3 flex size-16 items-center justify-center rounded-full bg-primary/10",children:e.jsx(V,{className:"size-8 text-primary"})}),e.jsx(R,{children:"Ouvrir la caisse"}),e.jsx(k,{children:"Sélectionnez un magasin et indiquez le montant initial pour commencer."})]}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"shop_id",children:"Magasin"}),e.jsxs(U,{value:r.data.shop_id,onValueChange:a=>r.setData("shop_id",a),children:[e.jsx(W,{id:"shop_id",children:e.jsx(X,{placeholder:"Choisir un magasin"})}),e.jsx(Y,{children:S.map(ne)})]}),r.errors.shop_id&&e.jsx("p",{className:"text-sm text-destructive",children:r.errors.shop_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"opening_amount",children:"Montant initial (FCFA)"}),e.jsx(P,{id:"opening_amount",type:"number",min:"0",step:"1",value:r.data.opening_amount,onChange:a=>r.setData("opening_amount",Number(a.target.value))}),r.errors.opening_amount&&e.jsx("p",{className:"text-sm text-destructive",children:r.errors.opening_amount})]})]}),e.jsx(O,{children:e.jsx(w,{type:"submit",className:"w-full",disabled:r.processing,children:r.processing?"Ouverture…":"Ouvrir la caisse"})})]})]})]})]}),s[28]=o,s[29]=n,s[30]=L,s[31]=F,s[32]=c,s[33]=r,s[34]=S,s[35]=v):v=s[35],v}function ne(t){return e.jsxs(Z,{value:t.id,children:[t.name," ",t.city?`(${t.city})`:""]},t.id)}function re(t,s){return t+Number(s.change_given)}function ae(t,s){return t+Number(s.amount)}function ie(t){return t.method==="customer_credit"}function le(t,s){return t+Number(s.amount)}function oe(t){return t.method==="bank_transfer"}function ce(t,s){return t+Number(s.amount)}function me(t){return t.method==="bank_card"}function de(t,s){return t+Number(s.amount)}function ue(t){return t.method==="mobile_money"}function xe(t,s){return t+Number(s.amount)}function pe(t){return t.method==="cash"}function fe(t,s){return t+Number(s.total)}function he(t){return t.payments}export{qe as default};
