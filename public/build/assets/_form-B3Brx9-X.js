import{c as De,r,j as e}from"./app-DqdLS_po.js";import{q as ke}from"./index-CSEUMRIG.js";import{B as E}from"./button-DVQP8ugw.js";import{I as R}from"./input-CikxobFJ.js";import{S as Fe}from"./scan-barcode-CkQBUiwX.js";import{X as fe}from"./x-C_vLIVyO.js";import{c as ze}from"./index-CJ7mWlm-.js";import{I as p}from"./input-error-CfDIxQqe.js";import{B as Ee}from"./badge-DSvvMiB9.js";import{b as ae,C as re,a as ne,c as ie}from"./card-z2brvHDy.js";import{e as je,d as ve,a as Ne,D as ye,b as be,c as Ce}from"./dialog-DIwoh3XE.js";import{L as m}from"./label-CKEEuidP.js";import{c as me,a as pe,b as xe,S as he,d as ge}from"./select-HYGYj5Xd.js";import{P as Re}from"./index-CxeexwSe.js";import{P as Se}from"./plus-fUC_Frcj.js";import{D as Ve,L as Pe}from"./layers-Ch73qmz6.js";import{T as Ie}from"./tag-I8YwbmSa.js";import{U as we}from"./upload-4o7i6hhE.js";/* empty css            */import"./index-CHdNXJ1h.js";import"./index-oTu_XNBi.js";import"./Combination-CjQPbJWN.js";import"./index-CQuKHLBU.js";import"./check-CFlOe0yf.js";import"./index-BY9hahA7.js";const Oe=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ue=ze("Camera",Oe),N=a=>({url:N.url(a),method:"post"});N.definition={methods:["post"],url:"/admin/product-categories"};N.url=a=>N.definition.url+ke(a);N.post=a=>({url:N.url(a),method:"post"});const Te=a=>({action:N.url(a),method:"post"});Te.post=a=>({action:N.url(a),method:"post"});N.form=Te;const y=a=>({url:y.url(a),method:"post"});y.definition={methods:["post"],url:"/admin/product-tags"};y.url=a=>y.definition.url+ke(a);y.post=a=>({url:y.url(a),method:"post"});const _e=a=>({action:y.url(a),method:"post"});_e.post=a=>({action:y.url(a),method:"post"});y.form=_e;function Ae(a){const s=De.c(41),{onScan:Y,placeholder:c,autoFocus:le,clearOnScan:ce,className:Q,mode:Z,name:M,defaultValue:oe,error:V}=a,ee=c===void 0?"Scanner ou saisir un code-barres…":c,P=le===void 0?!1:le,K=ce===void 0?!1:ce,q=Q===void 0?"":Q,I=Z===void 0?"input":Z,ue=oe===void 0?"":oe,[x,b]=r.useState(ue),[h,O]=r.useState(!1),X=r.useRef(null),C=r.useRef(null),g=r.useRef(null),$=r.useRef(0),f=r.useRef(""),j=r.useRef(null);let U;s[0]!==K||s[1]!==Y?(U=l=>{const i=l.trim();i&&(Y(i),b(K?"":i))},s[0]=K,s[1]=Y,s[2]=U):U=s[2];const o=U;let A,G;s[3]!==o||s[4]!==I?(A=()=>{if(I!=="inline")return;const l=function(u){const W=u.target;if(!(W.tagName==="TEXTAREA"||W.tagName==="INPUT"&&W!==X.current)){if(u.key==="Enter"){f.current.length>3&&(u.preventDefault(),o(f.current)),f.current="",j.current&&clearTimeout(j.current);return}u.key.length===1&&(f.current=f.current+u.key,j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{f.current=""},100))}};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l),j.current&&clearTimeout(j.current)}},G=[I,o],s[3]=o,s[4]=I,s[5]=A,s[6]=G):(A=s[5],G=s[6]),r.useEffect(A,G);let H;s[7]!==o||s[8]!==x?(H=l=>{l.key==="Enter"&&(l.preventDefault(),o(x))},s[7]=o,s[8]=x,s[9]=H):H=s[9];const w=H;let k;s[10]===Symbol.for("react.memo_cache_sentinel")?(k=()=>{g.current&&(g.current.getTracks().forEach(Le),g.current=null),$.current&&cancelAnimationFrame($.current),O(!1)},s[10]=k):k=s[10];const L=k;let T;s[11]!==o?(T=async()=>{if(!("BarcodeDetector"in window)){alert("La détection de code-barres par caméra n'est pas supportée par ce navigateur. Utilisez un scanner physique ou saisissez le code manuellement.");return}try{const l=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});g.current=l,O(!0),setTimeout(()=>{if(C.current&&g.current){C.current.srcObject=g.current,C.current.play();const i=new BarcodeDetector({formats:["ean_13","ean_8","code_128","code_39","upc_a","upc_e","qr_code"]}),u=async()=>{if(!(!C.current||!g.current)){try{const W=await i.detect(C.current);if(W.length>0){o(W[0].rawValue),L();return}}catch{}$.current=requestAnimationFrame(u)}};u()}},200)}catch{alert("Impossible d'accéder à la caméra. Vérifiez les permissions.")}},s[11]=o,s[12]=T):T=s[12];const de=T;let B,S;s[13]===Symbol.for("react.memo_cache_sentinel")?(B=()=>()=>L(),S=[L],s[13]=B,s[14]=S):(B=s[13],S=s[14]),r.useEffect(B,S);let _;s[15]===Symbol.for("react.memo_cache_sentinel")?(_=e.jsx(Fe,{className:"absolute left-2.5 top-2.5 size-4 text-muted-foreground"}),s[15]=_):_=s[15];let J;s[16]===Symbol.for("react.memo_cache_sentinel")?(J=l=>b(l.target.value),s[16]=J):J=s[16];let v;s[17]!==P||s[18]!==w||s[19]!==M||s[20]!==ee||s[21]!==x?(v=e.jsxs("div",{className:"relative flex-1",children:[_,e.jsx(R,{ref:X,type:"text",name:M,value:x,onChange:J,onKeyDown:w,placeholder:ee,className:"pl-9",autoFocus:P,autoComplete:"off"})]}),s[17]=P,s[18]=w,s[19]=M,s[20]=ee,s[21]=x,s[22]=v):v=s[22];const se=h?L:de,te=h?"Arrêter la caméra":"Scanner avec la caméra";let D;s[23]!==h?(D=h?e.jsx(fe,{className:"size-4"}):e.jsx(Ue,{className:"size-4"}),s[23]=h,s[24]=D):D=s[24];let F;s[25]!==se||s[26]!==te||s[27]!==D?(F=e.jsx(E,{type:"button",variant:"outline",size:"icon",onClick:se,title:te,children:D}),s[25]=se,s[26]=te,s[27]=D,s[28]=F):F=s[28];let z;s[29]!==v||s[30]!==F?(z=e.jsxs("div",{className:"relative flex gap-1.5",children:[v,F]}),s[29]=v,s[30]=F,s[31]=z):z=s[31];let t;s[32]!==V?(t=V&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:V}),s[32]=V,s[33]=t):t=s[33];let n;s[34]!==h?(n=h&&e.jsxs("div",{className:"relative mt-2 overflow-hidden rounded-lg border bg-black",children:[e.jsx("video",{ref:C,className:"h-48 w-full object-cover",muted:!0,playsInline:!0}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-0.5 w-3/4 bg-red-500/60"})}),e.jsx("p",{className:"absolute bottom-2 left-0 right-0 text-center text-xs text-white/80",children:"Placez le code-barres devant la caméra"})]}),s[34]=h,s[35]=n):n=s[35];let d;return s[36]!==q||s[37]!==z||s[38]!==t||s[39]!==n?(d=e.jsxs("div",{className:q,children:[z,t,n]}),s[36]=q,s[37]=z,s[38]=t,s[39]=n,s[40]=d):d=s[40],d}function Le(a){return a.stop()}const Be=[{value:"active",label:"Actif"},{value:"inactive",label:"Inactif"}],Me=[{value:"piece",label:"Pièce"},{value:"kilogram",label:"Kilogramme"},{value:"liter",label:"Litre"},{value:"meter",label:"Mètre"},{value:"square_meter",label:"Mètre²"},{value:"cubic_meter",label:"Mètre³"},{value:"pack",label:"Pack"},{value:"box",label:"Boîte"}];function xs({defaults:a={},categories:s,tags:Y,errors:c,onCategoriesChange:le,onTagsChange:ce}){const[Q,Z]=r.useState(a.category_id??""),[M,oe]=r.useState(a.status??"active"),[V,ee]=r.useState(a.unity??"piece"),[P,K]=r.useState(a.tags?.map(t=>t.id)??[]),[q,I]=r.useState(a.image??null),[ue,x]=r.useState(!1),b=r.useRef(null),[h,O]=r.useState(!1),[X,C]=r.useState(""),[g,$]=r.useState(""),[f,j]=r.useState(!1),[U,o]=r.useState(""),[A,G]=r.useState(s),[H,w]=r.useState(!1),[k,L]=r.useState(""),[T,de]=r.useState(!1),[B,S]=r.useState(""),[_,J]=r.useState(Y),v=r.useCallback(t=>{if(t&&t.type.startsWith("image/")){const n=new FileReader;n.onloadend=()=>I(n.result),n.readAsDataURL(t)}},[]),se=r.useCallback(t=>{t.preventDefault(),x(!1);const n=t.dataTransfer.files[0];n&&v(n)},[v]),te=()=>{I(null),b.current&&(b.current.value="")},D=t=>{K(n=>n.includes(t)?n.filter(d=>d!==t):[...n,t])};async function F(){if(!X.trim()){o("Le nom de la catégorie est obligatoire.");return}j(!0),o("");try{const t=N(),n=await fetch(t.url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split("; ").find(i=>i.startsWith("XSRF-TOKEN="))?.split("=")[1]??"")},body:JSON.stringify({name:X.trim(),description:g.trim()||null})});if(!n.ok){const i=await n.json();o(i.message||"Erreur lors de la création.");return}const d=await n.json(),l=[...A,d].sort((i,u)=>i.name.localeCompare(u.name));G(l),Z(d.id),le?.(l),O(!1),C(""),$("")}catch{o("Une erreur est survenue.")}finally{j(!1)}}async function z(){if(!k.trim()){S("Le nom du tag est obligatoire.");return}de(!0),S("");try{const t=y(),n=await fetch(t.url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split("; ").find(i=>i.startsWith("XSRF-TOKEN="))?.split("=")[1]??"")},body:JSON.stringify({name:k.trim()})});if(!n.ok){const i=await n.json();S(i.message||"Erreur lors de la création.");return}const d=await n.json(),l=[..._,d].sort((i,u)=>i.name.localeCompare(u.name));J(l),K(i=>[...i,d.id]),ce?.(l),w(!1),L("")}catch{S("Une erreur est survenue.")}finally{de(!1)}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"flex items-center gap-2 text-base",children:[e.jsx(Re,{className:"size-4"}),"Informations générales"]})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"name",children:["Nom ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"name",name:"name",defaultValue:a.name??"",placeholder:"Nom du produit",autoFocus:!0}),e.jsx(p,{message:c.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"code",children:["Code (code-barres) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Ae,{name:"code",defaultValue:a.code??"",onScan:()=>{},placeholder:"Scanner ou saisir le code…",error:c.code})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",defaultValue:a.description??"",rows:3,placeholder:"Décrivez le produit…",className:"border-input bg-background placeholder:text-muted-foreground focus-visible:ring-ring flex min-h-[80px] w-full rounded-md border px-3 py-2 text-sm shadow-xs focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50"}),e.jsx(p,{message:c.description})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"category_id",children:["Catégorie ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(me,{value:Q,onValueChange:Z,children:[e.jsx(pe,{id:"category_id",children:e.jsx(xe,{placeholder:"Choisir une catégorie"})}),e.jsx(he,{children:A.map(t=>e.jsx(ge,{value:t.id,children:t.name},t.id))})]}),e.jsx("input",{type:"hidden",name:"category_id",value:Q})]}),e.jsx(E,{type:"button",variant:"outline",size:"icon",onClick:()=>O(!0),title:"Créer une catégorie",children:e.jsx(Se,{className:"size-4"})})]}),e.jsx(p,{message:c.category_id})]})]})]}),e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ve,{className:"size-4"}),"Prix & Stock"]})}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"price",children:["Prix de vente ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"price",name:"price",type:"number",step:"0.01",min:"0",defaultValue:a.price??"",placeholder:"0.00"}),e.jsx(p,{message:c.price})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"cost_price",children:"Prix d'achat"}),e.jsx(R,{id:"cost_price",name:"cost_price",type:"number",step:"0.01",min:"0",defaultValue:a.cost_price??"",placeholder:"0.00"}),e.jsx(p,{message:c.cost_price})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"stock",children:["Stock ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"stock",name:"stock",type:"number",min:"0",defaultValue:a.stock??0}),e.jsx(p,{message:c.stock})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"stock_alert",children:"Seuil d'alerte"}),e.jsx(R,{id:"stock_alert",name:"stock_alert",type:"number",min:"0",defaultValue:a.stock_alert??0}),e.jsx(p,{message:c.stock_alert})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"unity",children:["Unité ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(me,{value:V,onValueChange:ee,children:[e.jsx(pe,{id:"unity",children:e.jsx(xe,{placeholder:"Unité"})}),e.jsx(he,{children:Me.map(t=>e.jsx(ge,{value:t.value,children:t.label},t.value))})]}),e.jsx("input",{type:"hidden",name:"unity",value:V}),e.jsx(p,{message:c.unity})]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"flex items-center gap-2 text-base",children:[e.jsx(Pe,{className:"size-4"}),"Statut"]})}),e.jsxs(ie,{children:[e.jsxs(me,{value:M,onValueChange:oe,children:[e.jsx(pe,{children:e.jsx(xe,{placeholder:"Statut"})}),e.jsx(he,{children:Be.map(t=>e.jsx(ge,{value:t.value,children:t.label},t.value))})]}),e.jsx("input",{type:"hidden",name:"status",value:M}),e.jsx(p,{message:c.status})]})]}),e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"flex items-center justify-between text-base",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"size-4"}),"Tags"]}),e.jsx(E,{type:"button",variant:"ghost",size:"icon",className:"size-7",onClick:()=>w(!0),title:"Créer un tag",children:e.jsx(Se,{className:"size-4"})})]})}),e.jsxs(ie,{children:[_.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun tag disponible."}):e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(t=>e.jsxs(Ee,{variant:P.includes(t.id)?"default":"outline",className:"cursor-pointer select-none",onClick:()=>D(t.id),children:[t.name,P.includes(t.id)&&e.jsx(fe,{className:"ml-1 size-3"})]},t.id))}),P.map(t=>e.jsx("input",{type:"hidden",name:"tags[]",value:t},t)),e.jsx(p,{message:c.tags})]})]}),e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"flex items-center gap-2 text-base",children:[e.jsx(we,{className:"size-4"}),"Image"]})}),e.jsxs(ie,{children:[q?e.jsxs("div",{className:"relative overflow-hidden rounded-md border",children:[e.jsx("img",{src:q,alt:"Aperçu",className:"h-36 w-full object-contain p-2"}),e.jsx(E,{type:"button",variant:"destructive",size:"icon",className:"absolute right-1 top-1 size-6",onClick:te,children:e.jsx(fe,{className:"size-3"})})]}):e.jsxs("div",{role:"button",tabIndex:0,className:`cursor-pointer rounded-md border-2 border-dashed p-6 text-center transition-colors ${ue?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,onDrop:se,onDragOver:t=>{t.preventDefault(),x(!0)},onDragLeave:()=>x(!1),onClick:()=>b.current?.click(),onKeyDown:t=>t.key==="Enter"&&b.current?.click(),children:[e.jsx(we,{className:"mx-auto mb-2 size-6 text-muted-foreground"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Glisser une image ou ",e.jsx("span",{className:"text-primary underline",children:"parcourir"})]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"PNG, JPG — 2 Mo max"})]}),e.jsx("input",{ref:b,type:"file",name:"image",accept:"image/*",className:"hidden",onChange:t=>v(t.target.files?.[0]??null)}),e.jsx(p,{message:c.image})]})]})]})]}),e.jsx(je,{open:h,onOpenChange:t=>!t&&O(!1),children:e.jsxs(ve,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Nouvelle catégorie"}),e.jsx(be,{children:"Créez une catégorie de produits. Elle sera automatiquement rattachée à votre entreprise."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"new-category-name",children:["Nom ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"new-category-name",value:X,onChange:t=>C(t.target.value),placeholder:"Nom de la catégorie",autoFocus:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"new-category-desc",children:"Description"}),e.jsx("textarea",{id:"new-category-desc",value:g,onChange:t=>$(t.target.value),rows:2,placeholder:"Description (optionnel)",className:"border-input bg-background placeholder:text-muted-foreground focus-visible:ring-ring flex min-h-[60px] w-full rounded-md border px-3 py-2 text-sm shadow-xs focus-visible:ring-1 focus-visible:outline-none"})]}),U&&e.jsx("p",{className:"text-sm text-destructive",children:U})]}),e.jsxs(Ce,{children:[e.jsx(E,{variant:"outline",onClick:()=>O(!1),disabled:f,children:"Annuler"}),e.jsx(E,{onClick:F,disabled:f,children:f?"Création…":"Créer"})]})]})}),e.jsx(je,{open:H,onOpenChange:t=>!t&&w(!1),children:e.jsxs(ve,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Nouveau tag"}),e.jsx(be,{children:"Créez un tag pour organiser vos produits."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"new-tag-name",children:["Nom ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"new-tag-name",value:k,onChange:t=>L(t.target.value),placeholder:"Nom du tag",autoFocus:!0})]}),B&&e.jsx("p",{className:"text-sm text-destructive",children:B})]}),e.jsxs(Ce,{children:[e.jsx(E,{variant:"outline",onClick:()=>w(!1),disabled:T,children:"Annuler"}),e.jsx(E,{onClick:z,disabled:T,children:T?"Création…":"Créer"})]})]})})]})}export{xs as default};
