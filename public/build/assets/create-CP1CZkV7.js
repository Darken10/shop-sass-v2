import{r as l,j as e,H as ne,F as de}from"./app-DqdLS_po.js";import{A as ce,J as Q,K as oe}from"./app-layout-BY_z2l7K.js";import{B as o}from"./button-DVQP8ugw.js";import{e as ue,f as me,d as pe,a as he,D as xe,b as je,c as ge}from"./dialog-DIwoh3XE.js";import{I as h}from"./input-CikxobFJ.js";import{L as n}from"./label-CKEEuidP.js";import{c as x,a as j,b as g,S as v,d as p}from"./select-HYGYj5Xd.js";import{P as G}from"./plus-fUC_Frcj.js";import{I as u}from"./input-error-CfDIxQqe.js";import{b as K,C as O,a as W,c as B}from"./card-z2brvHDy.js";import{C as ve}from"./checkbox-D2zvUl2l.js";import{S as ee}from"./separator-DGAiZpJH.js";import{A as ye}from"./arrow-left-DyOQbVss.js";import{T as fe}from"./truck-D0hplmIV.js";import{W as Ne}from"./warehouse-CXlB-vPY.js";import{C as be}from"./circle-dollar-sign-BZRWRA1r.js";import{C as se,S as Ce}from"./save-CcLVDqIY.js";import{P as Se}from"./index-CxeexwSe.js";/* empty css            */import"./index-CJ7mWlm-.js";import"./x-C_vLIVyO.js";import"./index-oTu_XNBi.js";import"./Combination-CjQPbJWN.js";import"./index-BY9hahA7.js";import"./index-CSEUMRIG.js";import"./SaleController-CWOAsHby.js";import"./index-CHdNXJ1h.js";import"./index-B_e8Ugpt.js";import"./app-logo-icon-BquCEMUK.js";import"./building-2-q9KNC_Mq.js";import"./store-B14O_uPo.js";import"./square-user-BhCGZFIc.js";import"./index-CQuKHLBU.js";import"./check-CFlOe0yf.js";const _e=[{value:"piece",label:"Pièce"},{value:"kilogram",label:"Kilogramme"},{value:"liter",label:"Litre"},{value:"meter",label:"Mètre"},{value:"square_meter",label:"Mètre carré"},{value:"cubic_meter",label:"Mètre cube"},{value:"pack",label:"Pack"},{value:"box",label:"Carton"}];function ke({categories:E,onProductCreated:H}){const[X,S]=l.useState(!1),[I,m]=l.useState(!1),[c,f]=l.useState({}),[_,k]=l.useState(""),[F,q]=l.useState(""),[w,T]=l.useState(""),[z,$]=l.useState(""),[A,N]=l.useState("piece"),[V,b]=l.useState("");function C(){k(""),q(""),T(""),$(""),N("piece"),b(""),f({})}async function P(t){t.preventDefault(),m(!0),f({});try{const y=await fetch("/admin/products/quick-store",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content??""},body:JSON.stringify({name:_,code:F,price:parseFloat(w),cost_price:z?parseFloat(z):null,unity:A,category_id:V})});if(!y.ok){const M=await y.json();if(M.errors){const R={};for(const[J,D]of Object.entries(M.errors))R[J]=Array.isArray(D)?D[0]:D;f(R)}return}const L=await y.json();H(L.product),C(),S(!1)}finally{m(!1)}}return e.jsxs(ue,{open:X,onOpenChange:t=>{S(t),t||C()},children:[e.jsx(me,{asChild:!0,children:e.jsxs(o,{type:"button",variant:"outline",size:"sm",children:[e.jsx(G,{className:"mr-1 size-4"}),"Créer un produit"]})}),e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Créer un produit rapidement"}),e.jsx(je,{children:"Ajoutez un nouveau produit qui sera immédiatement disponible dans la liste."})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"modal-name",children:["Nom ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(h,{id:"modal-name",value:_,onChange:t=>k(t.target.value),placeholder:"Nom du produit"}),c.name&&e.jsx("p",{className:"text-sm text-destructive",children:c.name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"modal-code",children:["Code ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(h,{id:"modal-code",value:F,onChange:t=>q(t.target.value),placeholder:"PRD-XXX"}),c.code&&e.jsx("p",{className:"text-sm text-destructive",children:c.code})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"modal-price",children:["Prix ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(h,{id:"modal-price",type:"number",min:"0",step:"0.01",value:w,onChange:t=>T(t.target.value),placeholder:"0.00"}),c.price&&e.jsx("p",{className:"text-sm text-destructive",children:c.price})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"modal-cost-price",children:"Prix d'achat"}),e.jsx(h,{id:"modal-cost-price",type:"number",min:"0",step:"0.01",value:z,onChange:t=>$(t.target.value),placeholder:"0.00"}),c.cost_price&&e.jsx("p",{className:"text-sm text-destructive",children:c.cost_price})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"modal-unity",children:["Unité ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(x,{value:A,onValueChange:N,children:[e.jsx(j,{id:"modal-unity",children:e.jsx(g,{placeholder:"Sélectionner"})}),e.jsx(v,{children:_e.map(t=>e.jsx(p,{value:t.value,children:t.label},t.value))})]}),c.unity&&e.jsx("p",{className:"text-sm text-destructive",children:c.unity})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"modal-category",children:["Catégorie ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(x,{value:V,onValueChange:b,children:[e.jsx(j,{id:"modal-category",children:e.jsx(g,{placeholder:"Sélectionner"})}),e.jsx(v,{children:E.map(t=>e.jsx(p,{value:t.id,children:t.name},t.id))})]}),c.category_id&&e.jsx("p",{className:"text-sm text-destructive",children:c.category_id})]})]}),e.jsxs(ge,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Annuler"}),e.jsx(o,{type:"submit",disabled:I,children:I?"Création…":"Créer le produit"})]})]})]})]})}const Fe=[{title:"Dashboard",href:"/dashboard"},{title:"Approvisionnements",href:Q().url},{title:"Nouvelle demande",href:"#"}];let ae=1,qe=1;function cs({warehouses:E,suppliers:H,products:X,categories:S,chargeTypes:I}){const[m,c]=l.useState(""),[f,_]=l.useState(""),[k,F]=l.useState(""),[q,w]=l.useState(""),[T,z]=l.useState(""),[$,A]=l.useState(""),[N,V]=l.useState(!1),[b,C]=l.useState([{key:ae++,product_id:"",quantity_requested:"1"}]),[P,t]=l.useState([]),[y,L]=l.useState(!1),[M,R]=l.useState(X);function J(){C(d=>[...d,{key:ae++,product_id:"",quantity_requested:"1"}])}function D(d){C(i=>i.filter(s=>s.key!==d))}function Y(d,i,s){C(r=>r.map(a=>a.key===d?{...a,[i]:s}:a))}function te(){t(d=>[...d,{key:qe++,label:"",type:"",amount:"",notes:""}])}function re(d){t(i=>i.filter(s=>s.key!==d))}function U(d,i,s){t(r=>r.map(a=>a.key===d?{...a,[i]:s}:a))}function ie(d){R(i=>[...i,d].sort((s,r)=>s.name.localeCompare(r.name)))}const Z=m==="supplier_to_warehouse",le=m==="warehouse_to_warehouse";return e.jsxs(ce,{breadcrumbs:Fe,children:[e.jsx(ne,{title:"Nouvelle demande d'approvisionnement"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{asChild:!0,variant:"ghost",size:"icon",className:"size-8",children:e.jsxs("a",{href:Q().url,children:[e.jsx(ye,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Retour"})]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Nouvelle demande d'approvisionnement"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fournisseur → Entrepôt ou Entrepôt → Entrepôt"})]})]}),e.jsx(ee,{}),e.jsx(de,{...oe.store.form(),children:({processing:d,errors:i})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto w-full max-w-2xl space-y-6",children:[e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs(W,{className:"flex items-center gap-2 text-base",children:[e.jsx(fe,{className:"size-4"}),"Type d'approvisionnement"]})}),e.jsx(B,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"type",children:["Type ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(x,{value:m,onValueChange:s=>{c(s),_(""),F(""),w("")},children:[e.jsx(j,{id:"type",children:e.jsx(g,{placeholder:"Sélectionner un type"})}),e.jsxs(v,{children:[e.jsx(p,{value:"supplier_to_warehouse",children:"Fournisseur → Entrepôt"}),e.jsx(p,{value:"warehouse_to_warehouse",children:"Entrepôt → Entrepôt"})]})]}),e.jsx("input",{type:"hidden",name:"type",value:m}),e.jsx(u,{message:i.type})]})})]}),m&&e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs(W,{className:"flex items-center gap-2 text-base",children:[e.jsx(Ne,{className:"size-4"}),Z?"Fournisseur & Entrepôt":"Entrepôts"]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Z&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"supplier_id",children:["Fournisseur ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(x,{value:f,onValueChange:_,children:[e.jsx(j,{id:"supplier_id",children:e.jsx(g,{placeholder:"Sélectionner un fournisseur"})}),e.jsx(v,{children:H.map(s=>e.jsxs(p,{value:s.id,children:[s.name," (",s.code,")"]},s.id))})]}),e.jsx("input",{type:"hidden",name:"supplier_id",value:f}),e.jsx(u,{message:i.supplier_id})]}),le&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"source_warehouse_id",children:["Entrepôt source ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(x,{value:k,onValueChange:F,children:[e.jsx(j,{id:"source_warehouse_id",children:e.jsx(g,{placeholder:"Source"})}),e.jsx(v,{children:E.map(s=>e.jsxs(p,{value:s.id,children:[s.name," (",s.code,")"]},s.id))})]}),e.jsx("input",{type:"hidden",name:"source_warehouse_id",value:k}),e.jsx(u,{message:i.source_warehouse_id})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"destination_warehouse_id",children:["Entrepôt destination ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(x,{value:q,onValueChange:w,children:[e.jsx(j,{id:"destination_warehouse_id",children:e.jsx(g,{placeholder:"Destination"})}),e.jsx(v,{children:E.map(s=>e.jsxs(p,{value:s.id,children:[s.name," (",s.code,")"]},s.id))})]}),e.jsx("input",{type:"hidden",name:"destination_warehouse_id",value:q}),e.jsx(u,{message:i.destination_warehouse_id})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",name:"notes",rows:2,placeholder:"Notes supplémentaires…",className:"border-input bg-background placeholder:text-muted-foreground focus-visible:ring-ring flex min-h-[60px] w-full rounded-md border px-3 py-2 text-sm shadow-xs focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50"}),e.jsx(u,{message:i.notes})]}),e.jsx(ee,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"driver_name",children:"Nom du chauffeur"}),e.jsx(h,{id:"driver_name",name:"driver_name",value:T,onChange:s=>z(s.target.value),placeholder:"Nom du chauffeur"}),e.jsx(u,{message:i.driver_name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"driver_phone",children:"Téléphone du chauffeur"}),e.jsx(h,{id:"driver_phone",name:"driver_phone",value:$,onChange:s=>A(s.target.value),placeholder:"Numéro de téléphone"}),e.jsx(u,{message:i.driver_phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{id:"company_bears_costs",checked:N,onCheckedChange:s=>V(s===!0)}),e.jsx(n,{htmlFor:"company_bears_costs",className:"font-normal",children:"L'entreprise prend en charge les frais de transport"}),e.jsx("input",{type:"hidden",name:"company_bears_costs",value:N?"1":"0"})]})]})]}),N&&e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs(W,{className:"flex items-center justify-between text-base",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"size-4"}),"Frais logistiques (",P.length,")"]}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:te,children:[e.jsx(G,{className:"size-4"}),"Ajouter"]})]})}),e.jsxs(B,{className:"space-y-4",children:[P.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun frais ajouté. Cliquez sur « Ajouter » pour enregistrer des frais logistiques."}),P.map((s,r)=>e.jsxs("div",{className:"flex items-end gap-3 rounded-lg border bg-muted/20 p-3",children:[e.jsxs("div",{className:"grid flex-1 gap-2",children:[e.jsx(n,{htmlFor:`charge-${r}-label`,children:"Libellé"}),e.jsx(h,{id:`charge-${r}-label`,name:`charges[${r}][label]`,value:s.label,onChange:a=>U(s.key,"label",a.target.value),placeholder:"Ex: Carburant Cotonou-Parakou"})]}),e.jsxs("div",{className:"grid w-40 gap-2",children:[e.jsx(n,{htmlFor:`charge-${r}-type`,children:"Type"}),e.jsxs(x,{value:s.type,onValueChange:a=>U(s.key,"type",a),children:[e.jsx(j,{id:`charge-${r}-type`,children:e.jsx(g,{placeholder:"Type"})}),e.jsx(v,{children:(I??[]).map(a=>e.jsx(p,{value:a.value,children:a.label},a.value))})]}),e.jsx("input",{type:"hidden",name:`charges[${r}][type]`,value:s.type})]}),e.jsxs("div",{className:"grid w-28 gap-2",children:[e.jsx(n,{htmlFor:`charge-${r}-amount`,children:"Montant"}),e.jsx(h,{id:`charge-${r}-amount`,name:`charges[${r}][amount]`,type:"number",min:"0",value:s.amount,onChange:a=>U(s.key,"amount",a.target.value)})]}),e.jsx(o,{type:"button",variant:"ghost",size:"icon",className:"mb-0.5 size-9 shrink-0 text-destructive hover:text-destructive",onClick:()=>re(s.key),children:e.jsx(se,{className:"size-4"})})]},s.key))]})]}),e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs(W,{className:"flex items-center justify-between text-base",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"size-4"}),"Articles (",b.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{categories:S,onProductCreated:ie}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:J,children:[e.jsx(G,{className:"size-4"}),"Ajouter"]})]})]})}),e.jsxs(B,{className:"space-y-4",children:[b.map((s,r)=>e.jsxs("div",{className:"flex items-end gap-3 rounded-lg border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex-1 grid gap-2",children:[e.jsxs(n,{htmlFor:`items-${r}-product`,children:["Produit ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(x,{value:s.product_id,onValueChange:a=>Y(s.key,"product_id",a),children:[e.jsx(j,{id:`items-${r}-product`,children:e.jsx(g,{placeholder:"Choisir"})}),e.jsx(v,{children:M.map(a=>e.jsxs(p,{value:a.id,children:[a.name," (",a.code,")"]},a.id))})]}),e.jsx("input",{type:"hidden",name:`items[${r}][product_id]`,value:s.product_id}),e.jsx(u,{message:i[`items.${r}.product_id`]})]}),e.jsxs("div",{className:"w-28 grid gap-2",children:[e.jsx(n,{htmlFor:`items-${r}-qty`,children:"Quantité"}),e.jsx(h,{id:`items-${r}-qty`,name:`items[${r}][quantity_requested]`,type:"number",min:"1",value:s.quantity_requested,onChange:a=>Y(s.key,"quantity_requested",a.target.value)}),e.jsx(u,{message:i[`items.${r}.quantity_requested`]})]}),b.length>1&&e.jsx(o,{type:"button",variant:"ghost",size:"icon",className:"mb-0.5 size-9 shrink-0 text-destructive hover:text-destructive",onClick:()=>D(s.key),children:e.jsx(se,{className:"size-4"})})]},s.key)),e.jsx(u,{message:i.items})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[e.jsx(o,{type:"button",variant:"outline",asChild:!0,children:e.jsx("a",{href:Q().url,children:"Annuler"})}),e.jsx("input",{type:"hidden",name:"is_draft",value:y?"1":"0"}),e.jsxs(o,{type:"submit",variant:"secondary",disabled:d,onClick:()=>L(!0),children:[e.jsx(Ce,{className:"size-4"}),d&&y?"Enregistrement…":"Sauvegarder brouillon"]}),e.jsx(o,{type:"submit",disabled:d||!m,onClick:()=>L(!1),children:d&&!y?"Enregistrement…":"Soumettre la demande"})]})]})})]})]})}export{cs as default};
