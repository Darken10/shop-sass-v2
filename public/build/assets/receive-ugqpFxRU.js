import{c as xt,r as Pe,j as t,a as pt,H as ht}from"./app-DqdLS_po.js";import{_ as lt,$ as jt,A as vt}from"./app-layout-BY_z2l7K.js";import{B as Ae}from"./badge-DSvvMiB9.js";import{B as Le}from"./button-DVQP8ugw.js";import{b as He,C as Be,a as Fe,e as yt,c as ie}from"./card-z2brvHDy.js";import{I as gt}from"./input-CikxobFJ.js";import{L as nt}from"./label-CKEEuidP.js";import{S as ct}from"./separator-DGAiZpJH.js";import{T as Nt}from"./textarea-DHjA_1zl.js";import{A as bt}from"./arrow-left-DyOQbVss.js";import{P as dt}from"./package-check-DzOLjUGY.js";import{C as ot}from"./check-CFlOe0yf.js";import{T as et}from"./triangle-alert-C1kSQOGD.js";import{C as tt}from"./circle-check-D8htzRxj.js";import{H as _t}from"./hash-CM8Hxcmz.js";import{W as qt}from"./warehouse-CXlB-vPY.js";import{P as St}from"./index-CxeexwSe.js";import{T as mt}from"./truck-D0hplmIV.js";/* empty css            */import"./index-CJ7mWlm-.js";import"./x-C_vLIVyO.js";import"./index-oTu_XNBi.js";import"./Combination-CjQPbJWN.js";import"./index-BY9hahA7.js";import"./index-CSEUMRIG.js";import"./SaleController-CWOAsHby.js";import"./index-CHdNXJ1h.js";import"./index-B_e8Ugpt.js";import"./app-logo-icon-BquCEMUK.js";import"./building-2-q9KNC_Mq.js";import"./store-B14O_uPo.js";import"./square-user-BhCGZFIc.js";const It={warehouse_to_shop:"Entrepôt → Magasin",warehouse_to_warehouse:"Entrepôt → Entrepôt"};function os(m){const e=xt.c(147),{transfer:s}=m;let re;e[0]!==s.items?(re=s.items.map(kt),e[0]=s.items,e[1]=re):re=e[1];const[n,ae]=Pe.useState(re);let le;e[2]===Symbol.for("react.memo_cache_sentinel")?(le={},e[2]=le):le=e[2];const[d,ee]=Pe.useState(le),[st,it]=Pe.useState(!1),[te,ne]=Pe.useState(0);let ce,de;e[3]===Symbol.for("react.memo_cache_sentinel")?(ce={title:"Dashboard",href:"/dashboard"},de={title:"Transferts",href:"/admin/logistics/transfers"},e[3]=ce,e[4]=de):(ce=e[3],de=e[4]);const ft=s.reference;let j;e[5]!==s.id?(j=lt(s.id),e[5]=s.id,e[6]=j):j=e[6];let v;e[7]!==j.url||e[8]!==s.reference?(v={title:ft,href:j.url},e[7]=j.url,e[8]=s.reference,e[9]=v):v=e[9];let oe;e[10]===Symbol.for("react.memo_cache_sentinel")?(oe={title:"Réception",href:"#"},e[10]=oe):oe=e[10];let me;e[11]!==v?(me=[ce,de,v,oe],e[11]=v,e[12]=me):me=e[12];const Me=me,rt=s.type==="warehouse_to_shop"?s.destination_shop:s.destination_warehouse,y=s.type==="warehouse_to_shop"?"Magasin":"Entrepôt";let fe;e[13]!==n?(fe=n.filter($t),e[13]=n,e[14]=fe):fe=e[14];const p=fe.length,u=n.length,ue=p===u;let xe;e[15]===Symbol.for("react.memo_cache_sentinel")?(xe=function(i,r){const a=r.quantity_delivered??r.quantity_requested;return parseInt(i.quantity_received)!==a},e[15]=xe):xe=e[15];const at=xe;let pe;e[16]!==d||e[17]!==n||e[18]!==u||e[19]!==s.items?(pe=function(i){const r=n[i],a=s.items.find(c=>c.id===r.item_id);if(!a)return;const l={...d};delete l[`items.${i}.quantity_received`],delete l[`items.${i}.discrepancy_note`];const o=parseInt(r.quantity_received);if(isNaN(o)||o<0){l[`items.${i}.quantity_received`]="La quantité doit être un nombre positif.",ee(l);return}const x=a.quantity_delivered??a.quantity_requested;if(o!==x&&!r.discrepancy_note.trim()){l[`items.${i}.discrepancy_note`]="Explication requise pour l'écart de quantité.",ee(l);return}if(ee(l),ae(c=>c.map((h,Ze)=>Ze===i?{...h,validated:!0}:h)),i<u-1){const c=n.findIndex((h,Ze)=>Ze>i&&!h.validated);c!==-1&&ne(c)}},e[16]=d,e[17]=n,e[18]=u,e[19]=s.items,e[20]=pe):pe=e[20];const se=pe;let he;e[21]===Symbol.for("react.memo_cache_sentinel")?(he=function(i){ae(r=>r.map((a,l)=>l===i?{...a,validated:!1}:a)),ne(i)},e[21]=he):he=e[21];const ut=he;let je;e[22]!==d?(je=function(i,r,a){ae(o=>o.map((x,c)=>c===i?{...x,[r]:a,validated:!1}:x));const l={...d};delete l[`items.${i}.quantity_received`],delete l[`items.${i}.discrepancy_note`],ee(l)},e[22]=d,e[23]=je):je=e[23];const g=je;let ve;e[24]!==ue||e[25]!==n||e[26]!==s.id?(ve=function(){ue&&(it(!0),pt.post(jt(s.id).url,{items:n.map(Ct)},{onFinish:()=>it(!1),onError:i=>{ee(i);const r=Object.keys(i).filter(zt).map(wt);r.length>0&&(ae(a=>a.map((l,o)=>r.includes(o)?{...l,validated:!1}:l)),ne(r[0]))}}))},e[24]=ue,e[25]=n,e[26]=s.id,e[27]=ve):ve=e[27];const Ve=ve,We=`Réception — ${s.reference}`;let N;e[28]!==We?(N=t.jsx(ht,{title:We}),e[28]=We,e[29]=N):N=e[29];let b;e[30]!==s.id?(b=lt(s.id),e[30]=s.id,e[31]=b):b=e[31];let ye,ge;e[32]===Symbol.for("react.memo_cache_sentinel")?(ye=t.jsx(bt,{className:"size-4"}),ge=t.jsx("span",{className:"sr-only",children:"Retour"}),e[32]=ye,e[33]=ge):(ye=e[32],ge=e[33]);let _;e[34]!==b.url?(_=t.jsx(Le,{asChild:!0,variant:"ghost",size:"icon",className:"size-8",children:t.jsxs("a",{href:b.url,children:[ye,ge]})}),e[34]=b.url,e[35]=_):_=e[35];let Ne;e[36]===Symbol.for("react.memo_cache_sentinel")?(Ne=t.jsx("h1",{className:"text-xl font-semibold",children:"Accusé de réception"}),e[36]=Ne):Ne=e[36];let q;e[37]!==s.reference?(q=t.jsxs("div",{children:[Ne,t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Transfert ",s.reference," — Validez chaque produit un par un"]})]}),e[37]=s.reference,e[38]=q):q=e[38];let S;e[39]!==_||e[40]!==q?(S=t.jsxs("div",{className:"flex items-center gap-4",children:[_,q]}),e[39]=_,e[40]=q,e[41]=S):S=e[41];let I;e[42]!==p?(I=t.jsx("span",{className:"font-semibold text-foreground",children:p}),e[42]=p,e[43]=I):I=e[43];let w;e[44]!==I||e[45]!==u?(w=t.jsxs("div",{className:"text-sm text-muted-foreground",children:[I," / ",u," validés"]}),e[44]=I,e[45]=u,e[46]=w):w=e[46];const Oe=!ue||st;let be;e[47]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsx(dt,{className:"size-4"}),e[47]=be):be=e[47];const Qe=st?"Traitement…":"Confirmer la réception";let z;e[48]!==Ve||e[49]!==Oe||e[50]!==Qe?(z=t.jsxs(Le,{onClick:Ve,disabled:Oe,children:[be,Qe]}),e[48]=Ve,e[49]=Oe,e[50]=Qe,e[51]=z):z=e[51];let C;e[52]!==w||e[53]!==z?(C=t.jsxs("div",{className:"flex items-center gap-3",children:[w,z]}),e[52]=w,e[53]=z,e[54]=C):C=e[54];let $;e[55]!==S||e[56]!==C?($=t.jsxs("div",{className:"flex items-center justify-between",children:[S,C]}),e[55]=S,e[56]=C,e[57]=$):$=e[57];let _e;e[58]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsx(ct,{}),e[58]=_e):_e=e[58];let qe;e[59]===Symbol.for("react.memo_cache_sentinel")?(qe=t.jsx("span",{className:"font-medium",children:"Progression de la réception"}),e[59]=qe):qe=e[59];let k;e[60]!==u||e[61]!==p?(k=Math.round(p/u*100),e[60]=u,e[61]=p,e[62]=k):k=e[62];let E;e[63]!==k?(E=t.jsxs("div",{className:"mb-2 flex items-center justify-between text-sm",children:[qe,t.jsxs("span",{className:"text-muted-foreground",children:[k,"%"]})]}),e[63]=k,e[64]=E):E=e[64];const Ue=`${p/u*100}%`;let T;e[65]!==Ue?(T=t.jsx("div",{className:"h-2 overflow-hidden rounded-full bg-muted",children:t.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-300",style:{width:Ue}})}),e[65]=Ue,e[66]=T):T=e[66];let R;e[67]!==E||e[68]!==T?(R=t.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4",children:[E,T]}),e[67]=E,e[68]=T,e[69]=R):R=e[69];let D;if(e[70]!==te||e[71]!==d||e[72]!==n||e[73]!==s.items||e[74]!==g||e[75]!==se){let f;e[77]!==te||e[78]!==d||e[79]!==n||e[80]!==g||e[81]!==se?(f=(i,r)=>{const a=n[r];if(!a)return null;const l=i.quantity_delivered??i.quantity_requested,o=at(a,i),x=te===r,c=a.validated;return t.jsxs(He,{className:`transition-all ${c?"border-green-500/50 bg-green-50/50 dark:bg-green-950/10":x?"border-primary ring-1 ring-primary/20":"opacity-75"}`,onClick:()=>{c||ne(r)},children:[t.jsx(Be,{className:"pb-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`flex size-8 items-center justify-center rounded-full text-sm font-bold ${c?"bg-green-500 text-white":"bg-muted text-muted-foreground"}`,children:c?t.jsx(ot,{className:"size-4"}):r+1}),t.jsxs("div",{children:[t.jsx(Fe,{className:"text-base",children:i.product.name}),t.jsx(yt,{children:i.product.code})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(Ae,{variant:"outline",children:["Demandé : ",i.quantity_requested]}),t.jsxs(Ae,{variant:"secondary",children:["Expédié : ",l]}),c&&t.jsxs(Ae,{variant:o?"destructive":"default",className:o?"":"bg-green-500",children:["Reçu : ",a.quantity_received]})]})]})}),!c&&(x||!x&&!c)&&t.jsxs(ie,{className:"space-y-4",children:[t.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(nt,{htmlFor:`qty-${i.id}`,children:"Quantité reçue"}),t.jsx(gt,{id:`qty-${i.id}`,type:"number",min:0,value:a.quantity_received,onChange:h=>g(r,"quantity_received",h.target.value),className:d[`items.${r}.quantity_received`]?"border-destructive":"",autoFocus:x}),d[`items.${r}.quantity_received`]&&t.jsx("p",{className:"text-xs text-destructive",children:d[`items.${r}.quantity_received`]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("div",{className:"w-full rounded-lg border bg-muted/50 p-3 text-sm",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Écart"}),o?t.jsxs("span",{className:"flex items-center gap-1 font-semibold text-destructive",children:[t.jsx(et,{className:"size-3"}),parseInt(a.quantity_received)-l]}):t.jsxs("span",{className:"flex items-center gap-1 font-semibold text-green-600",children:[t.jsx(tt,{className:"size-3"}),"Conforme"]})]})})})]}),o&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs(nt,{htmlFor:`note-${i.id}`,className:"flex items-center gap-1 text-destructive",children:[t.jsx(et,{className:"size-3"}),"Explication de l'écart (obligatoire)"]}),t.jsx(Nt,{id:`note-${i.id}`,placeholder:"Décrivez la raison de la différence entre la quantité expédiée et la quantité reçue…",value:a.discrepancy_note,onChange:h=>g(r,"discrepancy_note",h.target.value),rows:3,className:d[`items.${r}.discrepancy_note`]?"border-destructive":""}),d[`items.${r}.discrepancy_note`]&&t.jsx("p",{className:"text-xs text-destructive",children:d[`items.${r}.discrepancy_note`]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs(Le,{size:"sm",onClick:()=>se(r),children:[t.jsx(ot,{className:"size-4"}),"Valider ce produit"]})})]}),c&&t.jsx(ie,{className:"pt-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[t.jsx(tt,{className:"size-4"}),"Produit validé",a.discrepancy_note&&t.jsxs("span",{className:"text-muted-foreground",children:["— ",a.discrepancy_note]})]}),t.jsx(Le,{variant:"ghost",size:"sm",onClick:()=>ut(r),children:"Modifier"})]})})]},i.id)},e[77]=te,e[78]=d,e[79]=n,e[80]=g,e[81]=se,e[82]=f):f=e[82],D=s.items.map(f),e[70]=te,e[71]=d,e[72]=n,e[73]=s.items,e[74]=g,e[75]=se,e[76]=D}else D=e[76];let P;e[83]!==R||e[84]!==D?(P=t.jsxs("div",{className:"space-y-4 lg:col-span-2",children:[R,D]}),e[83]=R,e[84]=D,e[85]=P):P=e[85];let Se;e[86]===Symbol.for("react.memo_cache_sentinel")?(Se=t.jsx(Be,{children:t.jsxs(Fe,{className:"flex items-center gap-2 text-base",children:[t.jsx(_t,{className:"size-4"}),"Détails du transfert"]})}),e[86]=Se):Se=e[86];let Ie;e[87]===Symbol.for("react.memo_cache_sentinel")?(Ie=t.jsx("span",{className:"text-muted-foreground",children:"Référence"}),e[87]=Ie):Ie=e[87];let A;e[88]!==s.reference?(A=t.jsxs("div",{className:"flex items-center justify-between",children:[Ie,t.jsx("span",{className:"font-medium",children:s.reference})]}),e[88]=s.reference,e[89]=A):A=e[89];let we;e[90]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsx("span",{className:"text-muted-foreground",children:"Type"}),e[90]=we):we=e[90];const Ge=It[s.type];let L;e[91]!==Ge?(L=t.jsxs("div",{className:"flex items-center justify-between",children:[we,t.jsx(Ae,{variant:"outline",children:Ge})]}),e[91]=Ge,e[92]=L):L=e[92];let ze;e[93]===Symbol.for("react.memo_cache_sentinel")?(ze=t.jsx(ct,{}),e[93]=ze):ze=e[93];let Ce;e[94]===Symbol.for("react.memo_cache_sentinel")?(Ce=t.jsx(qt,{className:"size-3.5"}),e[94]=Ce):Ce=e[94];const Je=s.source_warehouse?.name??"—";let H;e[95]!==Je?(H=t.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[Ce,t.jsxs("span",{children:["Source : ",t.jsx("strong",{children:Je})]})]}),e[95]=Je,e[96]=H):H=e[96];let $e;e[97]===Symbol.for("react.memo_cache_sentinel")?($e=t.jsx(St,{className:"size-3.5"}),e[97]=$e):$e=e[97];const Ke=rt?.name??"—";let B;e[98]!==Ke?(B=t.jsx("strong",{children:Ke}),e[98]=Ke,e[99]=B):B=e[99];let F;e[100]!==y||e[101]!==B?(F=t.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[$e,t.jsxs("span",{children:[y," : ",B]})]}),e[100]=y,e[101]=B,e[102]=F):F=e[102];let M;e[103]!==H||e[104]!==F?(M=t.jsxs("div",{className:"space-y-2",children:[H,F]}),e[103]=H,e[104]=F,e[105]=M):M=e[105];let V;e[106]!==A||e[107]!==L||e[108]!==M?(V=t.jsxs(He,{children:[Se,t.jsxs(ie,{className:"space-y-3 text-sm",children:[A,L,ze,M]})]}),e[106]=A,e[107]=L,e[108]=M,e[109]=V):V=e[109];let ke;e[110]===Symbol.for("react.memo_cache_sentinel")?(ke=t.jsx(Be,{children:t.jsxs(Fe,{className:"flex items-center gap-2 text-base",children:[t.jsx(dt,{className:"size-4"}),"Récapitulatif"]})}),e[110]=ke):ke=e[110];let W;if(e[111]!==n||e[112]!==s.items){let f;e[114]!==s.items?(f=(i,r)=>{const a=s.items[r];if(!a)return null;const l=a.quantity_delivered??a.quantity_requested,o=at(i,a);return t.jsxs("div",{className:`flex items-center justify-between rounded-md px-2 py-1.5 ${i.validated?o?"bg-amber-50 dark:bg-amber-950/10":"bg-green-50 dark:bg-green-950/10":"bg-muted/50"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[i.validated?o?t.jsx(et,{className:"size-3.5 text-amber-500"}):t.jsx(tt,{className:"size-3.5 text-green-500"}):t.jsx("div",{className:"size-3.5 rounded-full border"}),t.jsx("span",{className:"truncate",children:a.product.name})]}),i.validated&&t.jsxs("span",{className:`text-xs font-medium ${o?"text-amber-600":"text-green-600"}`,children:[i.quantity_received," / ",l]})]},i.item_id)},e[114]=s.items,e[115]=f):f=e[115],W=n.map(f),e[111]=n,e[112]=s.items,e[113]=W}else W=e[113];let O;e[116]!==W?(O=t.jsxs(He,{children:[ke,t.jsx(ie,{className:"space-y-2 text-sm",children:W})]}),e[116]=W,e[117]=O):O=e[117];let Ee;e[118]===Symbol.for("react.memo_cache_sentinel")?(Ee=t.jsx(Be,{children:t.jsxs(Fe,{className:"flex items-center gap-2 text-base",children:[t.jsx(mt,{className:"size-4"}),"Itinéraire"]})}),e[118]=Ee):Ee=e[118];let Te;e[119]===Symbol.for("react.memo_cache_sentinel")?(Te=t.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Source"}),e[119]=Te):Te=e[119];const Xe=s.source_warehouse?.name??"—";let Q;e[120]!==Xe?(Q=t.jsxs("div",{className:"flex-1 rounded-lg border bg-muted/30 p-3 text-center",children:[Te,t.jsx("p",{className:"text-xs font-semibold",children:Xe})]}),e[120]=Xe,e[121]=Q):Q=e[121];let Re;e[122]===Symbol.for("react.memo_cache_sentinel")?(Re=t.jsx(mt,{className:"size-4 shrink-0 text-muted-foreground"}),e[122]=Re):Re=e[122];let U;e[123]!==y?(U=t.jsx("p",{className:"text-[10px] text-muted-foreground",children:y}),e[123]=y,e[124]=U):U=e[124];const Ye=rt?.name??"—";let G;e[125]!==Ye?(G=t.jsx("p",{className:"text-xs font-semibold",children:Ye}),e[125]=Ye,e[126]=G):G=e[126];let J;e[127]!==U||e[128]!==G?(J=t.jsxs("div",{className:"flex-1 rounded-lg border bg-muted/30 p-3 text-center",children:[U,G]}),e[127]=U,e[128]=G,e[129]=J):J=e[129];let K;e[130]!==Q||e[131]!==J?(K=t.jsxs(He,{children:[Ee,t.jsx(ie,{children:t.jsxs("div",{className:"flex items-center gap-3",children:[Q,Re,J]})})]}),e[130]=Q,e[131]=J,e[132]=K):K=e[132];let X;e[133]!==V||e[134]!==O||e[135]!==K?(X=t.jsxs("div",{className:"space-y-6",children:[V,O,K]}),e[133]=V,e[134]=O,e[135]=K,e[136]=X):X=e[136];let Y;e[137]!==P||e[138]!==X?(Y=t.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[P,X]}),e[137]=P,e[138]=X,e[139]=Y):Y=e[139];let Z;e[140]!==$||e[141]!==Y?(Z=t.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-6",children:[$,_e,Y]}),e[140]=$,e[141]=Y,e[142]=Z):Z=e[142];let De;return e[143]!==Me||e[144]!==N||e[145]!==Z?(De=t.jsxs(vt,{breadcrumbs:Me,children:[N,Z]}),e[143]=Me,e[144]=N,e[145]=Z,e[146]=De):De=e[146],De}function wt(m){return parseInt(m.split(".")[1])}function zt(m){return m.startsWith("items.")}function Ct(m){return{item_id:m.item_id,quantity_received:parseInt(m.quantity_received),discrepancy_note:m.discrepancy_note||null}}function $t(m){return m.validated}function kt(m){return{item_id:m.id,quantity_received:String(m.quantity_delivered??m.quantity_requested),discrepancy_note:"",validated:!1}}export{os as default};
